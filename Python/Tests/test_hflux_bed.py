import numpy as np
import sys
import os
import pytest

#Find the root directory dynmimically. https://stackoverflow.com/questions/73230007/how-can-i-set-a-root-directory-dynamically
root_dir = os.path.abspath(os.path.join(os.path.dirname(__file__), "..", ".."))
sys.path.append(root_dir)
from Python.src.Heat_Flux.hflux_bed import hflux_bed

def test_hflux_bed():

    depth_of_measure = np.array([2] * 100)
    water_temp = np.array([17.443] * 100)
    bed_temp = np.array([12] * 100)
    
    width_m = [4.89149604764764,
4.86849618992830,
4.84548770754097,
4.82247060434835,
4.79944488420915,
4.77641055097814,
4.75336760850614,
4.73031606064005,
4.70725591122288,
4.68418716409361,
4.66110982308743,
4.63802389203550,
4.61492937476515,
4.59182627509980,
4.56871459685897,
4.54559434385827,
4.52246551990949,
4.49932812882045,
4.47618217439520,
4.45302766043385,
4.42986459073270,
4.40669296908421,
4.38351279927692,
4.36032408509559,
4.33712683032115,
4.31392103873068,
4.29070671409742,
4.26748386019085,
4.24425248077660,
4.22101257961648,
4.19776416046855,
4.17450722708702,
4.15124178322235,
4.12796783262122,
4.10468537902654,
4.08139442617740,
4.05809497780918,
4.03478703765347,
4.01147060943814,
3.98814569688726,
3.96481230372123,
3.94147043365662,
3.91812009040635,
3.89476127767961,
3.87139399918182,
3.84801825861472,
3.82463405967635,
3.80124140606102,
3.77784030145937,
3.75443074955835,
3.73101275404118,
3.70758631858747,
3.68415144687310,
3.66070814257029,
3.63725640934763,
3.61379625087000,
3.59032767079870,
3.56685067279130,
3.54336526050180,
3.51983201780430,
3.49585670427846,
3.47187967544622,
3.44816272787448,
3.42492453599910,
3.40167379855372,
3.37841052362434,
3.35513471928501,
3.33184639359795,
3.30854555461348,
3.28523221037010,
3.26190636889453,
3.23856803820170,
3.21521722629477,
3.19185394116523,
3.16847819079280,
3.14508998314559,
3.12144070884813,
3.09745739356492,
3.07347087947567,
3.04948116710805,
3.02548825698959,
3.00149214964754,
2.97749284560899,
2.95349034540084,
2.92948464954976,
2.90547575858225,
2.88146367302457,
2.85744839340282,
2.83342992024289,
2.80940825407045,
2.78538339541100,
2.76135534478981,
2.73732410273198,
2.71328966976241,
2.68925204640576,
2.66521123318653,
2.64116723062902,
2.61712003925732,
2.59306965959531,
2.56930760128219]

    wp_m = [4.89454170600277,
4.87155730185408,
4.84856442494694,
4.82556308139676,
4.80255327735974,
4.77953501903399,
4.75650831266069,
4.73347316452529,
4.71042958095876,
4.68737756833873,
4.66431713309099,
4.64124828169065,
4.61817102066363,
4.59508535658808,
4.57199129609579,
4.54888884587375,
4.52577801266575,
4.50265880327390,
4.47953122456040,
4.45639528344917,
4.43325098692771,
4.41009834204888,
4.38693735593276,
4.36376803576867,
4.34059038881720,
4.31740442241223,
4.29421014396307,
4.27100756095683,
4.24779668096056,
4.22457751162369,
4.20135006068052,
4.17811433595272,
4.15487034535201,
4.13161809688285,
4.10835759864528,
4.08508885883779,
4.06181188576045,
4.03852668781788,
4.01523327352267,
3.99193165149859,
3.96862183048418,
3.94530381933622,
3.92197762703364,
3.89864326268127,
3.87530073551390,
3.85195005490043,
3.82859123034823,
3.80522427150760,
3.78184918817644,
3.75846599030512,
3.73507468800139,
3.71167529153577,
3.68826781134683,
3.66485225804688,
3.64142864242784,
3.61799697546730,
3.59455726833492,
3.57110953239888,
3.54765377923292,
3.52415055248241,
3.50020512768850,
3.47625840176189,
3.45257251473938,
3.42936644775219,
3.40614828932987,
3.38291805726109,
3.35967576960076,
3.33642144468014,
3.31315510111730,
3.28987675782809,
3.26658643403762,
3.24328414929214,
3.21996992347157,
3.19664377680255,
3.17330572987204,
3.14995580364163,
3.12634501151132,
3.10240025813423,
3.07845291146446,
3.05450298639360,
3.03055049827059,
3.00659546292006,
2.98263789666159,
2.95867781632989,
2.93471523929594,
2.91075018348927,
2.88678266742125,
2.86281271020963,
2.83884033160430,
2.81486555201437,
2.79088839253667,
2.76690887498575,
2.74292702192539,
2.71894285670188,
2.69495640347902,
2.67096768727504,
2.64697673400154,
2.62298357050457,
2.59898822460796,
2.57528291222288]
    
    sed_type = [1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
1.40000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
0.84000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000,
2.50000000000000]
    
    bed = hflux_bed(sed_type, water_temp, bed_temp, depth_of_measure, width_m, wp_m)
        
    ### round to 10 digits for consistency across programs
    correct = True

    matlab_output = [-3.81247233410512,
-3.81249563555017,
-3.81251928195798,
-3.81254328017086,
-3.81256763720155,
-3.81259236023842,
-3.81261745665070,
-3.81264293399404,
-3.81266880001613,
-3.81269506266264,
-3.81272173008327,
-3.81274881063813,
-3.81277631290424,
-3.81280424568234,
-3.81283261800394,
-3.81286143913857,
-3.81289071860141,
-3.81292046616111,
-3.81295069184794,
-3.81298140596221,
-3.81301261908312,
-3.81304434207777,
-3.81307658611070,
-3.81310936265365,
-3.81314268349580,
-3.81317656075434,
-3.81321100688548,
-3.81324603469593,
-3.81328165735476,
-3.81331788840579,
-3.81335474178047,
-3.81339223181123,
-3.81343037324544,
-3.81346918125992,
-3.81350867147598,
-3.81354885997518,
-3.81358976331568,
-3.81363139854928,
-3.81367378323919,
-3.81371693547854,
-3.81376087390970,
-2.28828337064662,
-2.28831071207076,
-2.28833856086682,
-2.28836692966441,
-2.28839583148853,
-2.28842527977449,
-2.28845528838350,
-2.28848587161900,
-2.28851704424370,
-2.28854882149733,
-2.28858121911534,
-2.28861425334830,
-2.28864794098230,
-2.28868229936026,
-2.28871734640424,
-2.28875310063878,
-2.28878958121538,
-2.28882680793814,
-2.28886480129061,
-2.28890358246394,
-2.28894317338645,
-2.28898359675455,
-2.28902487606531,
-2.28906703565053,
-2.28911010071262,
-2.28915409736222,
-2.28919905265772,
-2.28924499464692,
-6.81336890598405,
-6.81351177413335,
-6.81365784829997,
-6.81380722510822,
-6.81396000484928,
-6.81411629164936,
-6.81427619364702,
-6.81443982318008,
-6.81460729698278,
-6.81477873639380,
-6.81495426757592,
-6.81513402174791,
-6.81531813542957,
-6.81550675070076,
-6.81570001547523,
-6.81589808379045,
-6.81610111611418,
-6.81630927966929,
-6.81652274877775,
-6.81674170522525,
-6.81696633864787,
-6.81719684694234,
-6.81743343670144,
-6.81767632367650,
-6.81792573326877,
-6.81818190105185,
-6.81844507332741,
-6.81871550771661,
-6.81899347378994,
-6.81927925373824,
-6.81957314308820]

    for i in range(len(bed)):
        ours = str(round(bed[i], 10))
        matlab = str(round(matlab_output[i], 10))
        if ours != matlab:
            print(ours, matlab)
            correct = False
    
    assert correct
    print(correct)
    
test_hflux_bed()
    